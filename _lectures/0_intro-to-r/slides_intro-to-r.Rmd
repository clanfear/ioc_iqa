---
title: "Introduction to R"
subtitle: "IQA Lecture 0"
author: "Charles Lanfear"
date: "6 Oct 2022<br>Updated: `r gsub(' 0', ' ', format(Sys.Date(), format='%e %b %Y'))`"
output:
  xaringan::moon_reader:
    css: cam-css.css
    lib_dir: libs
    nature:
      highlightStyle: tomorrow-night-bright
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "../assets/cam_macros.js"
      titleSlideClass: ["center","top"]
---

```{r setup, purl=FALSE}
#| include: false
knitr::opts_chunk$set(eval=TRUE, echo=TRUE, message=TRUE, warning=TRUE, dev = "svg")
```


# Course Goals


* Cultivate basic competence with applied statistics

  * *We'll start this next week*

--

* Develop intermediate R data management and visualization skills

  * *We'll start this today*

--

* Prepare you for advanced topics in quantitative analysis


--

* Introduce reproducible research practices

---
class: inverse

.text-align-center[
# Why are you doing this to me?
]

---

# Reasons

--

### You *will* read quantitative research

* Interpretation
* Evaluation

--

### You *may* do quantitative research

* Analysis
* Reporting

--

Pratt (2015):

.text-72[
> And another good reason to have a strong – and more importantly, eclectic – methodological skill‐set is so that you will not have to define (and therefore confine) yourself as either a quantitative or qualitative criminologist (although some people enthusiastically embrace such labels). You can instead call yourself a criminologist and be safe in the knowledge that you have command of whatever methodological “tool” you will need to answer whatever criminological question you have decided to ask.

]


---
class: inverse

.text-align-center[
# Okay, but programming?
]

---
# Data *analysis* is mostly data *wrangling*

.footnote[Credit: Kieran Healy]

--

&nbsp;

## Data wrangling is **frustrating**

---
class: inverse

# Well, can we make it fun?

---


.text-big-center[
**NO**
]

---
class: inverse

# Can we at least make it not frustrating?

---

.text-big-center[
**ALSO<br>NO**
]

---
# Programming is *important*

* Cleaning data by hand is:

  * Error prone
  * Time consuming
  * Not **reproducible**

--

* It opens *many* doors

--

* Frustration is *always* present

--

* But what frustrates you *changes*

---

# Logistics

Location: Computer Lab, Wed, 14:00-16:00

Jing's email: [ss2826@cam.ac.uk]()

* Your first point of contact for troubleshooting!

My email: [cl948@cam.ac.uk]()

* For non-troubleshooting questions---or *really* broken stuff

My drop-in times:

* 3.9, Tue, 14:00-15:00
* 3.9, Wed, 11:00-12:00

---

# Materials

All course materials are on the course website: [http://clanfear.github.io/ioc_iqa](). 

This includes:

* These slides and the code used to generate them.
* An R script for the slides to follow along in class.
* Useful links to other resources.
* **Formative assignments**

If something doesn't work, email me.

---

# A Note on Slide Formatting

**Bold** is an important term.

--

*Italics* are emphasis or mouse-click instructions

* "Click *File \> Print*"

--

`Code` is R code you type in or keystrokes for actions

* "Press `Ctrl-P` to open the print dialogue."

--

Code chunks are *actual embedded R code*.

```{r}
#| code-line-numbers: "1|2"
# Sometimes important stuff is highlighted! #<<
7 * 49
```

--

`##` indicates the output from running the code chunk.

---
class: inverse

# R and RStudio

---

# Why R?

R is a programming language built for statistical computing.

If one already knows Excel, SPSS, or Stata, why use R?

--

* R is *free*, so you don't need a terminal server or license.

--

* R has a *very* large community for support and packages.

--

* R can handle virtually any data format.

--

* R makes replication *easy*.

--

* R is a *language* so it can do *everything*.<sup>1</sup>

.footnote[[1] Including making these slides and the course webpage.]

--

* R is similar to other programming languages.


---

# R Studio

R Studio is a "front-end" or integrated development environment (IDE) for R that can make your life *easier*.

--

We'll show RStudio can...

* Organize your code, output, and plots

--

* Auto-complete code and highlight syntax

--

* Help view data and objects

--

* Enable easy integration of R code into documents with **Quarto** and **RMarkdown**

--

It can also...

* Manage `git` repositories

* Run interactive tutorials

* Handle other languages like Python, SQL, and HTML

---

# Getting Started

Open up RStudio now and choose *File \> New File \> R Script*.

Then, let's get oriented with the interface:

--

* *Top Left*: Code **editor** pane, data viewer (browse with tabs)

--

* *Bottom Left*: **Console** for running code (`>` prompt)

--

* *Top Right*: List of objects in **environment**, code **history** tab.

--

* *Bottom Right*: Tabs for browsing files, viewing plots, managing packages, and viewing help files.

--

You can change the layout in *Preferences \> Pane Layout*

---

# Editing and Running Code

There are several ways to run R code in RStudio:

--

* Highlight lines in the **editor** window and click *Run* at the top or hit `Ctrl+Enter` or `⌘+Enter` to run them all.

--

* With your **caret** (.blink[`|`]) on a line you want to run, hit `Ctrl+Enter` or `⌘+Enter`. Note your caret moves to the next line, so you can run code sequentially with repeated presses.

--

* Type individual lines in the **console** and press `Enter`.

The console will show the lines you ran followed by any printed output.

---

# Incomplete Code

If you mess up (e.g. leave off a parenthesis), R might show a `+` sign prompting you to finish the command:

```{r Coding 1, eval=FALSE}
> (11-2
+
```

Finish the command or hit `Esc` to get out of this.

---

# R as a Calculator

In the **console**, type `123 + 456 + 789` and hit `Enter`.

--

```{r Calc 1}
123 + 456 + 789
```

--

The `[1]` in the output indicates the numeric **index** of the first element on that line.

--

Now in your blank R document in the **editor**, try typing the line `sqrt(400)` and either clicking *Run* or hitting `Ctrl+Enter` or `⌘+Enter`.

--

```{r Calc 2}
sqrt(400)
```

---
# Functions and Help

`sqrt()` is an example of a **function** in R.

--

If we didn't have a good guess as to what `sqrt()` will do, we can type `?sqrt` in the console and look at the **Help** panel on the right.

```{r Help, eval=FALSE}
?sqrt
```

--

**Arguments** are the *inputs* to a function. In this case, the only argument to `sqrt()` is `x` which can be a number or a vector of numbers.

Help files provide documentation on how to use functions and what functions produce.

---

# Creating Objects

R stores *everything* as an **object**, including data, functions, models, and output.

--

Creating an object can be done using the **assignment operator**: `<-`

--

```{r Objects 1}
new.object <- 144
```

--

**Operators** like `<-` are functions that look like symbols but typically sit between their arguments (e.g. numbers or objects) instead of having them inside `()` like in `sqrt(x)`.<sup>1</sup>

.footnote[[1] We can call operators like other functions using backticks: <code>\`+\`(x,y)</code>]

--

We do math with operators, e.g., `x + y`. `+` is the addition operator!

---

# Calling Objects

You can display or "call" an object simply by using its name.

```{r Objects 2}
new.object
```

--

Object names can contain `_` and `.` in them, but cannot *begin* with numbers. Try to be consistent in naming objects.

--

Auto-complete means *long names are better than vague ones*!

*Good names*<sup>1</sup> save confusion later.

.footnote[[1] *"There are only two hard things in Computer Science: cache invalidation and naming things." - Phil Karlton*]

---

# Using Objects

You can treat the object's **name** as if it were the values stored inside.

--

```{r Objects 3}
new.object + 10
new.object + new.object
sqrt(new.object)
```

---

# Creating Vectors

A **vector** is a series of **elements**, such as numbers.

--

You can create a vector using the function `c()` which stands for "combine".

--

```{r Vectors 1}
new.object <- c(4, 9, 16, 25, 36)
new.object
```

--

Assigning to an existing name *overwrites that object*.

--

You can provide a vector as an argument for many functions.

--

```{r Vectors 2}
sqrt(new.object)
```

---

# More Complex Objects

The same principles can be used to create more complex objects:

* **matrices**
* **arrays**
* **lists**
* **dataframes**

--

Most data sets you will work with will be read into R and stored as a **dataframe**. 

Consequently, we will focus on manipulating and analyzing these dataframes.

---
class: inverse

# Data Frames

---

# What's Up with `USArrests`?

In our Quarto doc, let's load the built-in dataframe `USArrests`. 

--

`data(USArrests)` loads this dataframe into the **Global Environment** (as a *promise*<sup>1</sup>).

.footnote[[1] Promises are *unevaluated arguments*. Read more about R's [lazy evaluation here](http://adv-r.had.co.nz/Functions.html).]

--

`View(cars)` pops up a **Viewer** pane ("interactive" use only, don't put in R Markdown document!) or...

--

```{r}
head(USArrests, 5) # prints first 5 rows, see tail() too
```



---

# More About `USArrests`

`str()` displays the structure of an object:

.text-72[
```{r}
str(USArrests) # str[ucture]
```
]

--

`summary()` displays summary information<sup>1</sup>:

.text-72[
```{r}
summary(USArrests)
```
]

.footnote[[1] Note R `summary()` provides different information for different types of objects!]

---

# Ugly Pictures of `USArrests`

`hist()` generates a histogram of a vector. Note you can access a vector that is a column of a dataframe using `$`, the **extract operator**.

.pull-left[
```{r, out.height="330px"}
hist(USArrests$Murder)
```
]

.pull-right[
```{r, out.height="330px"}
hist(USArrests$UrbanPop)
```
]

---

## Drawing Slightly Less Ugly Pictures


```{r, out.height="400px"}
hist(USArrests$Murder,
     xlab = "Homicide Rate", # X axis label
     main = "Homicide Rates of US States") # Title
```


---

# Math with `USArrests`

If you put an assignment such as `x <- y` in parentheses `()`, R will print the output of the assignment out for you in your document. Otherwise, it won't show the value.
--

```{r}
( murder_mean  <- mean(USArrests$Murder) )
( pop_mean <- mean(USArrests$UrbanPop) )
```

---

# Drawing Still Ugly Pictures

.text-85[
```{r, out.height="330px"}
plot(Murder ~ UrbanPop, data = USArrests, #<<
     xlab = "Urban Population (100k)",
     ylab = "Homicides (per 100k)",
     main = "Homicide and urban populations in the US",
     pch = 16) # Point size
abline(h = murder_mean, col = "firebrick")
abline(v = pop_mean, col = "cornflowerblue")
```
]

.pull-right[
.footnote[Note that `Murder ~ UrbanPop` is a **formula** of the type `y ~ x`. The first element (`Murder`) gets plotted on the y-axis and the second (`UrbanPop`) goes on the x-axis. Regression formulae follow this convention as well!]
]

---

class: inverse

&nbsp;

&nbsp;


![](img/swirl_new_large_final.png)

---
# Installing Packages

Let's make a table that looks a little less code-y in the output. To do this, we'll 
want to install a **package** called `pander`. Packages contain premade functions 
and/or data we can use. R's strength is its wide variety of packages!

In the console: `install.packages("pander")`.

--

* Note that unlike the `library()` command, *the name of a package to be installed must be in quotes*. This is because the name here is a search term (text, not an object!) while for `library()` it is an actual R object.

--

* Once you install a package, you don't need to re-install it until you update R. *Consequently, you should not include* `install.packages()` *in any markdown document or R script!*

---

# Making Tables

```{r, eval=FALSE}
library(pander) # loads pander, do once in your session
pander(summary(cars), style = "rmarkdown") #<<
```

.text-72[
```{r, echo=FALSE}
library(pander) # loads pander, do once in your session
pander(summary(cars), style = "rmarkdown")
```
]

.footnote[Note that we put the `summary(cars)` function call inside the `pander()` call. This is called *nesting functions*. I'll introduce a method next week to simplify this!]


---
class: inverse

# For Next Time

* Read first two chapters of Kaplan (2022)
   * Try to run the code in Chapter 2 as you read<sup>1</sup>

* Try out some `swirl` tutorials
   
.footnote[[1] If you run into problems you can't get past quickly, set it aside until next week!]
